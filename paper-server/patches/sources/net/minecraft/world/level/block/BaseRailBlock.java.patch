--- a/net/minecraft/world/level/block/BaseRailBlock.java
+++ b/net/minecraft/world/level/block/BaseRailBlock.java
@@ -71,6 +_,7 @@
         state = this.updateDir(level, pos, state, true);
         if (this.isStraight) {
             level.neighborChanged(state, pos, this, null, movedByPiston);
+            state = level.getBlockState(pos); // Paper - Fix some rails connecting improperly
         }
 
         return state;
@@ -81,13 +_,31 @@
         if (!level.isClientSide && level.getBlockState(pos).is(this)) {
             RailShape railShape = state.getValue(this.getShapeProperty());
             if (shouldBeRemoved(pos, level, railShape)) {
-                dropResources(state, level, pos);
+                // Paper start - BlockDestroyEvent
+                com.destroystokyo.paper.event.block.BlockDestroyEvent event = new com.destroystokyo.paper.event.block.BlockDestroyEvent(org.bukkit.craftbukkit.block.CraftBlock.at(level, pos), level.getFluidState(pos).createLegacyBlock().createCraftBlockData(), state.createCraftBlockData(), 0, true);
+                event.setPlayEffect(false);
+                if (!event.callEvent())
+                    return;
+                level.expToDrop = event.getExpToDrop();
+                if (event.playEffect())
+                    level.levelEvent(2001, pos, Block.getId(((org.bukkit.craftbukkit.block.data.CraftBlockData) event.getEffectBlock()).getState()));
+                if (event.willDrop())
+                    dropResources(state, level, pos);
+                level.expToDrop = 0;
+                // Paper end - BlockDestroyEvent
                 level.removeBlock(pos, movedByPiston);
             } else {
                 this.updateState(state, level, pos, neighborBlock);
             }
         }
     }
+
+    // Paper start - BlockDestroyEvent
+    @Override
+    public int getExpDrop(final BlockState iblockdata, final net.minecraft.server.level.ServerLevel worldserver, final BlockPos blockposition, final net.minecraft.world.item.ItemStack itemstack, final boolean flag) {
+        return worldserver.expToDrop;
+    }
+    // Paper end - BlockDestroyEvent
 
     private static boolean shouldBeRemoved(BlockPos pos, Level level, RailShape shape) {
         if (!canSupportRigidBlock(level, pos.below())) {
